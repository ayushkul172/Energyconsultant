<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - AK Energy Consultant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-chart-line text-blue-600"></i> Analytics Dashboard
                </h1>
                <p class="text-gray-600">Real-time visitor tracking and analytics</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Visits</p>
                            <p class="text-3xl font-bold text-blue-600" id="totalVisits">0</p>
                        </div>
                        <i class="fas fa-users text-4xl text-blue-200"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Unique Visitors</p>
                            <p class="text-3xl font-bold text-green-600" id="uniqueVisitors">0</p>
                        </div>
                        <i class="fas fa-user-check text-4xl text-green-200"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Countries</p>
                            <p class="text-3xl font-bold text-purple-600" id="totalCountries">0</p>
                        </div>
                        <i class="fas fa-globe text-4xl text-purple-200"></i>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Avg Time</p>
                            <p class="text-3xl font-bold text-orange-600" id="avgTime">0s</p>
                        </div>
                        <i class="fas fa-clock text-4xl text-orange-200"></i>
                    </div>
                </div>
            </div>

            <!-- Export Button -->
            <div class="bg-white rounded-lg shadow p-6 mb-6">
                <button onclick="exportToCSV()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-download mr-2"></i> Export to CSV
                </button>
                <button onclick="clearData()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition ml-4">
                    <i class="fas fa-trash mr-2"></i> Clear All Data
                </button>
            </div>

            <!-- Visitors Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <div class="p-6 border-b">
                    <h2 class="text-xl font-bold text-gray-800">Recent Visitors</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Address</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Location</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Device</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Page</th>
                            </tr>
                        </thead>
                        <tbody id="visitorTable" class="divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // This would normally fetch from a database
        // For now, we'll show how to structure it
        function loadAnalytics() {
            // In production, this would call your Netlify function to get stored data
            // For demo purposes, showing structure
            const mockData = [
                {
                    timestamp: new Date().toISOString(),
                    ip_address: '44.203.82.108',
                    location: 'Virginia',
                    country: 'United States',
                    device_type: 'Desktop',
                    page_title: 'Home Page'
                }
            ];
            
            displayData(mockData);
        }

        function displayData(data) {
            document.getElementById('totalVisits').textContent = data.length;
            document.getElementById('uniqueVisitors').textContent = new Set(data.map(d => d.ip_address)).size;
            document.getElementById('totalCountries').textContent = new Set(data.map(d => d.country)).size;
            
            const tbody = document.getElementById('visitorTable');
            tbody.innerHTML = data.map(visit => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 text-sm">${new Date(visit.timestamp).toLocaleString()}</td>
                    <td class="px-6 py-4 text-sm font-mono">${visit.ip_address}</td>
                    <td class="px-6 py-4 text-sm">${visit.location}, ${visit.country}</td>
                    <td class="px-6 py-4 text-sm">${visit.device_type || 'Unknown'}</td>
                    <td class="px-6 py-4 text-sm">${visit.page_title || 'N/A'}</td>
                </tr>
            `).join('');
        }

        function exportToCSV() {
            alert('CSV export would download your analytics data');
        }

        function clearData() {
            if (confirm('Are you sure you want to clear all analytics data?')) {
                alert('Data cleared (in production, this would clear the database)');
            }
        }

        loadAnalytics();
    </script>
</body>
</html>
